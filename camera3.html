<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Camera Focus on ID Card</title>
    <style>
      #video {
        width: 100%;
        height: 75vh;
        object-fit: cover;
        /* Adjusts the video to fill the area without distortion */
      }
    </style>
  </head>
  <body>
    <div style="position: relative; width: 100%">
      <div
        style="
          display: flex;
          justify-content: center;
          align-items: center;
          padding-bottom: 10px;
        "
      >
        <video id="video" autoplay playsinline></video>
        <canvas id="canvas" style="display: none"></canvas>
      </div>
      <div style="display: flex; justify-content: center; align-items: center">
        <button id="captureButton" style="width: 150px; height: 40px">
          Capture Photo
        </button>
      </div>
      <div id="resultCapture"></div>
    </div>
    <script>
      const video = document.getElementById("video");
      const canvas = document.getElementById("canvas");
      const captureButton = document.getElementById("captureButton");

      // Request video stream with rear camera (environment facing)
      // const stream = await navigator.mediaDevices.getUserMedia({
      //       video: { facingMode: "environment" },
      //     });
      //     video.srcObject = stream;

      const constraints = {
        video: {
          width: { ideal: 1280 }, // Higher resolution for better clarity
          height: { ideal: 720 },
          facingMode: "environment",
          focusMode: { ideal: "continuous" }, // Autofocus if available
          zoom: { ideal: 1.5 }, // Slight zoom to focus on the ID card area (if supported)
        },
      };

      navigator.mediaDevices
        .getUserMedia(constraints)
        .then((stream) => {
          video.srcObject = stream;
          video.play();
        })
        .catch((error) => console.error("Camera access failed:", error));

      // Draw a guide box for ID card alignment
      video.addEventListener("loadeddata", () => {
        canvas.width = video.videoWidth;
        canvas.height = video.videoHeight;

        function draw() {
          context.drawImage(video, 0, 0, canvas.width, canvas.height);

          // Customize the guide box dimensions for the ID card
          const boxWidth = 320; // Adjust as per ID card size
          const boxHeight = 200;
          const boxX = (canvas.width - boxWidth) / 2;
          const boxY = (canvas.height - boxHeight) / 2;

          context.strokeStyle = "green";
          context.lineWidth = 3;
          context.strokeRect(boxX, boxY, boxWidth, boxHeight);

          requestAnimationFrame(draw);
        }

        draw();
      });

      captureButton.addEventListener("click", () => {
        // Set the canvas dimensions to match the video stream
        canvas.width = video.videoWidth;
        canvas.height = video.videoHeight;

        // Draw the current frame from video onto the canvas
        const context = canvas.getContext("2d");
        context.drawImage(video, 0, 0, canvas.width, canvas.height);

        // Stop the video stream to end live mode
        video.srcObject.getTracks().forEach((track) => track.stop());

        // Hide the video and show the captured photo on the canvas
        video.style.display = "none";
        canvas.style.display = "block";
      });
    </script>
  </body>
</html>
